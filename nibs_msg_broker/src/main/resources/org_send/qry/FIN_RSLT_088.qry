#USE_COL_CNT, COL_LEN, COL_TYPE 순으로 정의되어 져야 하며 SELECT 절 내부를 제외하고는 라인을 띄우면 안된다.
#SELECT 문의 COLUMN은 반드시 50개를 채워줘야 한다.(USE_COL_CNT 만큼 제외한 컬럼은 '' 등 으로 정의
USE_COL_CNT=33
COL_LEN=8,10,8,12,6,4,4,60,8,60,4,8,6,1,1,4,4,1,8,6,8,10,13,10,8,6,40,200,50,4,20,3,65
COL_TYPE=A,A,A,A,A,A,A,A,A,A,A,A,A,N,N,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A,A
SELECT  /*+ INDEX(MNG IX_T_CT_ERROR_MNG_04)*/ 
         MNG.trans_date,
         MNG.org_msg_no,
         MNG.JIJUM_CD,
         DECODE( substr( MNG.sec, 1, 1 ), '2', '', DECODE(substr( MNG.sec, 1, 1 ), '8', '', MNG.mac_no )), /* 민원출동은 기번 없이 feedback */
         MNG.SITE_CD,
         LPAD(MNG.org_call_cnt, 2, '0'),
         '',
         '',         
         MNG.error_cd,
         ERR.error_msg,
         '',
         MNG.send_date,
         MNG.send_time,
         SUBSTR(MNG.sec, 1, 1),
         DECODE(SUBSTR(MNG.sec, 3, 1), NULL, '1', SUBSTR(MNG.sec, 3, 1)),
         '1',/*==>20100823 신영건 요청 신한은행 모두 완료로 처리 DECODE( SUBSTR(MNG.error_status, 3, 1), '0', '1', '0' ),*/
         /*DECODE(SUBSTR(MNG.error_status, 4, 1), '7', '9', SUBSTR(MNG.error_status, 4, 1)),*/
         /* 신한은행 자동 수동 출동 요청이 아닌경우 조치사유가 T_CM_COMMON에 정의된것과 매칭시킬수 없어 전원이외 모두 기타로 */
         '0',/*==>20100823 신영건 요청 신한은행 모두 완료로 처리 DECODE( MNG.format_type, '21', DECODE( SUBSTR(MNG.error_status, 4, 1), '8', '7', '9', '7', SUBSTR(MNG.error_status, 4, 1) ),
                     DECODE( SUBSTR(MNG.error_status, 3, 1), '0', '0', DECODE( SUBSTR(MNG.error_status, 4, 1), '3', '7' ))), */
         /*SUBSTR(MNG.as_medium, 2, 1),*/
         /*==>20100823 신영건 요청 신한은행 모두 완료로 처리 
         SUBSTR(AS1.ACCEPT_AS_CODE, 2, 1),
         DECODE(AS1.accept_time, '', DECODE(MNG.finish_time, '', TO_CHAR(SYSDATE, 'YYYYMMDD'), MNG.finish_date ), AS1.accept_date ) as finish_date,
         DECODE(AS1.accept_time, '', DECODE(MNG.finish_time, '', TO_CHAR(SYSDATE, 'HH24MISS'), MNG.finish_time ), AS1.accept_time ) as finish_time,
         */
         '',
         DECODE(MNG.finish_time, '', TO_CHAR(SYSDATE, 'YYYYMMDD'), MNG.finish_date ) AS FINISH_DATE,
         DECODE(MNG.finish_time, '', TO_CHAR(SYSDATE, 'HH24MISS'), MNG.finish_time ) AS FINISH_TIME,
         CASE WHEN MNG.org_send_yn = '2'
                    then DECODE(MNG.finish_uid, NULL, 'nice', MNG.finish_uid)
                WHEN MNG.org_send_yn = '3' and
                      MNG.finish_type = '0001' AND
                   MNG.finish_nm = '취소' AND
                   MNG.arrival_time IS NOT NULL
                   THEN DECODE(MNG.recv_user_uid, NULL,
                                                 'nice', MNG.recv_user_uid)
         END finishuid,
         CASE WHEN MNG.org_send_yn = '2'
                    then DECODE(MNG.finish_nm, NULL, '나이스', MNG.finish_nm)
                WHEN MNG.org_send_yn = '3' and
                      MNG.finish_type = '0001' AND
                   MNG.finish_nm = '취소' AND
                   MNG.arrival_time IS NOT NULL
                   THEN DECODE(MNG.recv_user_nm, NULL,
                                    DECODE(MNG.recv_user_uid, NULL, '나이스', MBR.member_nm), MNG.recv_user_nm)
         END finishnm,
         '0800228252',
         '나이스',
         MNG.arrival_date,
         MNG.arrival_time,
         '',
         RTRIM( MNG.msg ),
         '',
         '', 
         '',
         '', 
         '',
         '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', ''
   FROM T_CT_ERROR_MNG     MNG,
        T_CM_MEMBER        MBR,
        T_CT_ERROR         ERR/*==>20100823 신영건 요청 신한은행 모두 완료로 처리 ,
        T_CT_AS            AS1 */
/* 콜 취소가 아닌것 중 예정시간이나 도착없이 완료된것도 보낼수 있도록 */
/* 20080617 LG 이지은 요청                                               */
WHERE MNG.org_cd = '088'
   /*AND MNG.send_time IS NOT NULL*/
   AND MNG.error_status IS NOT NULL
   AND (    MNG.org_send_yn = '2'
            OR (    MNG.arrival_est_time IS NULL
                AND MNG.arrival_time IS NULL
                AND MNG.org_send_yn = '0'
               )
            OR (    MNG.arrival_est_time IS NOT NULL
                AND MNG.arrival_time IS NULL
                AND MNG.org_send_yn = '1'
               )
            /* 도착이 은행에서 99 오류로 준것도 완료를 보내도록 한다. */   
            OR MNG.org_send_yn = 'b'
            /* AS 처리완료된건에대해서 완료 시간을 다시 보내도록 한다. 20090217 */
            /* AS 처리완료건은 다시보내지 않도록 수정 LG 요청 20090409
            OR MNG.org_send_yn = '5'
            */
       )
   AND ( NVL(MNG.repair_date, '0')||NVL(MNG.repair_time, '0') <> NVL(MNG.finish_date, '0')|| NVL(MNG.finish_time, '0') )
   /*AND (MNG.format_type = '21' OR MNG.format_type = '31')*/
   /* sec : 출동요청구분 + 사유로 구성 */
   AND MNG.sec IS NOT NULL
   AND MNG.CREATE_DATE > TO_NUMBER(TO_CHAR((SYSDATE - 10), 'YYYYMMDD') )
   AND MNG.org_cd = ERR.org_cd(+)
   AND MNG.error_cd = ERR.error_cd(+)
   AND MNG.recv_user_uid = MBR.member_id(+)
   /*==>20100823 신영건 요청 신한은행 모두 완료로 처리 
   AND MNG.CREATE_DATE = AS1.CREATE_DATE(+)
   AND MNG.ERROR_NO = AS1.ERROR_NO(+)
   AND MNG.ORG_CD = AS1.ORG_CD(+)
   AND MNG.JIJUM_CD = AS1.JIJUM_CD(+)
   AND MNG.MAC_NO = AS1.MAC_NO(+)
   */
   /* 2차출동요청에대한 키지원일경우 제외 */
   AND substr(MNG.sec, 3, 1) || MNG.ERROR_CD <> '2SH903'
union all
SELECT   trans_date,
         org_msg_no,
         JIJUM_CD,
         MAC_NO,
         SITE_CD,
         LPAD(org_call_cnt, 2, '0'),
         '',
         '',         
         error_cd,
         '',
         '',
         send_date,
         send_time,
         CALL_CLASS,
         CALL_CNT_TYPE,
         '1',/*==>20100823 신영건 요청 신한은행 모두 완료로 처리 DECODE( SUBSTR(MNG.error_status, 3, 1), '0', '1', '0' ),*/
         /*DECODE(SUBSTR(MNG.error_status, 4, 1), '7', '9', SUBSTR(MNG.error_status, 4, 1)),*/
         /* 신한은행 자동 수동 출동 요청이 아닌경우 조치사유가 T_CM_COMMON에 정의된것과 매칭시킬수 없어 전원이외 모두 기타로 */
         '0',/*==>20100823 신영건 요청 신한은행 모두 완료로 처리 DECODE( MNG.format_type, '21', DECODE( SUBSTR(MNG.error_status, 4, 1), '8', '7', '9', '7', SUBSTR(MNG.error_status, 4, 1) ),
                     DECODE( SUBSTR(MNG.error_status, 3, 1), '0', '0', DECODE( SUBSTR(MNG.error_status, 4, 1), '3', '7' ))), */
         /*SUBSTR(MNG.as_medium, 2, 1),*/
         /*==>20100823 신영건 요청 신한은행 모두 완료로 처리 
         SUBSTR(AS1.ACCEPT_AS_CODE, 2, 1),
         DECODE(AS1.accept_time, '', DECODE(MNG.finish_time, '', TO_CHAR(SYSDATE, 'YYYYMMDD'), MNG.finish_date ), AS1.accept_date ) as finish_date,
         DECODE(AS1.accept_time, '', DECODE(MNG.finish_time, '', TO_CHAR(SYSDATE, 'HH24MISS'), MNG.finish_time ), AS1.accept_time ) as finish_time,
         */
         '',
         FINISH_DATE,
         FINISH_TIME,
         '',         
         DECODE(COM_MAN_NM, NULL, '나이스', COM_MAN_NM ),
         DECODE(COM_MAN_TEL_NO , NULL, '0800228252', FC_FN_SECURITY(COM_MAN_TEL_NO, '2') ),
         '나이스',
         arrival_date,
         arrival_time,
         '',
         RTRIM( org_msg ),
         '',
         '', 
         '',
         '', 
         '',
         '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', ''
FROM T_CT_ERROR_MNG_MADE_COM
WHERE ORG_CD = '088'
AND   (		ORG_SEND_YN = '3'
       OR	(	ORG_SEND_YN = '1' AND ARRIVAL_EST_TIME IS NULL AND ARRIVAL_TIME IS NULL )
       OR   (   ORG_SEND_YN = '2' AND ARRIVAL_TIME IS NULL )
      )
AND	  FINISH_TIME IS NOT NULL
AND	  ORG_MSG_NO IS NOT NULL
