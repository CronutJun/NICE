<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="MISS_NO">

<!--
<entry key="MISS_NO"                value="04002110" />     36. 결번요청
{
   "name" : "04002110",                    "kname" : "결번요청",
   "response" : { "code" : "04002110",     "type" : "SELF" },
   "columns" : [
      { "name" : "CM",                     "kname" : "공통헤더",               "type" : "INC", "include" : "comm_msg_header.json" },
      { "name" : "req_date",               "kname" : "요청전문일자",           "type" : "N",   "length"  : 8   },
      { "name" : "req_seq",                "kname" : "요청전문일련번호",       "type" : "AN",  "length"  : 10  },
      { "name" : "message",                "kname" : "Message",                "type" : "AN",  "length"  : 100 },
      { "name" : "init_seq",               "kname" : "최초일련번호",           "type" : "AN",  "length"  : 10  },
      { "name" : "final_seq",              "kname" : "최종일련번호",           "type" : "AN",  "length"  : 10  },
      { "name" : "req_code",               "kname" : "요청구분",               "type" : "AN",  "length"  : 1   },
      { "name" : "filler",                 "kname" : "여유공간",               "type" : "AN",  "length"  : 71  }
   ]
}
 -->
    <select id="select0EM" resultType="hashmap" parameterType="com.nicetcm.nibsplus.orgsend.model.OrgSendQryParamVO">
    <![CDATA[
        SELECT  A.gw_DATE req_date,
                A.TRANS_SEQ_NO req_seq,
                '',
                '',
                '',
                '',
                '',
                '',
                '',
                '',
                '',
                '','','','','','','','','','','','','','', '', '', '','','', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', ''
        FROM
             (
                SELECT  gw_DATE,
                        TRANS_SEQ_NO
                FROM     op.T_IF_LOG_EXTIF@EMARTDB
                WHERE   gw_DATE between TO_CHAR(SYSDATE - 2, 'YYYYMMDD') and to_char(sysdate, 'yyyymmdd')
                AND     TRANS_TYPE = 'S'
                AND     REQ_TYPE = 'Q'
                AND     EXT_COM_CD = '096'
                AND     FORMAT_TYPE = 'CM'
                MINUS
                SELECT     TRANS_DATE as gw_date, lpad(TO_CHAR(TRANS_SEQ_NO), 7, '0')
                FROM     op.T_IF_DATA_LOG
                WHERE     ORG_CD = '0EM'
                AND     TRANS_DATE between TO_CHAR(SYSDATE - 2, 'YYYYMMDD') and to_char(sysdate, 'yyyymmdd')
                AND     TRANS_TYPE = 'QR'
            ) A
        ORDER BY A.GW_DATE||A.TRANS_SEQ_NO
    ]]>
    </select>

    <select id="select0EL" resultType="hashmap" parameterType="com.nicetcm.nibsplus.orgsend.model.OrgSendQryParamVO">
    <![CDATA[
        SELECT  A.gw_DATE req_date,
                A.TRANS_SEQ_NO req_seq,
                '',
                '',
                '',
                '',
                '',
                '',
                '',
                '',
                '',
                '','','','','','','','','','','','','','', '', '', '','','', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', ''
        FROM
             (
                SELECT  gw_DATE,
                        TRANS_SEQ_NO
                FROM     op.T_IF_LOG_EXTIF@eland
                WHERE     gw_DATE between TO_CHAR(SYSDATE - 1, 'YYYYMMDD') and TO_CHAR(SYSDATE , 'YYYYMMDD')
                AND     TRANS_TYPE = 'S'
                AND     REQ_TYPE = 'Q'
                AND     EXT_COM_CD = '096'
                AND     FORMAT_TYPE = 'CM'
               MINUS
                SELECT     TRANS_DATE as gw_date, lpad(TO_CHAR(TRANS_SEQ_NO), 7, '0')
                FROM     op.T_IF_DATA_LOG
                WHERE     ORG_CD = '0EL'
                AND     TRANS_DATE between TO_CHAR(SYSDATE - 1, 'YYYYMMDD') and TO_CHAR(SYSDATE , 'YYYYMMDD')
                AND     TRANS_TYPE = 'QR'
            ) A
        ORDER BY A.GW_DATE||A.TRANS_SEQ_NO
    ]]>
    </select>
    <select id="select0TR" resultType="hashmap" parameterType="com.nicetcm.nibsplus.orgsend.model.OrgSendQryParamVO">
    <![CDATA[
        SELECT  A.DEAL_DATE,
        A.trans_seq,
        '',
        '',
        '',
        '1',
        '',
        '',
        '',
        '',
        '',
        '',
        '','','','','','','','','','','','','', '', '', '','','', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', ''
from   (      
            SELECT  TO_CHAR(SYSDATE-1, 'YYYYMMDD') as deal_date,
                     trans_seq_no  as trans_seq
            FROM T_IF_MISSNO_CHK 
            WHERE trans_seq_no <= (select MAX(TRANS_SEQ)+1 from t_fn_realtime_TRADE where org_cd = '0TR' AND DEAL_DATE = TO_CHAR(SYSDATE-1, 'YYYYMMDD'))
            MINUS 
            SELECT  deal_date,
                    trans_seq   as trans_seq
            from t_fn_realtime_TRADE
            where org_cd = '0TR' 
            AND DEAL_DATE = TO_CHAR(SYSDATE-1, 'YYYYMMDD') 
        ) A
    ]]>
    </select>
</mapper>